<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Postpartum</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; padding:16px; }
    #page { margin:auto; width:100%; max-width:900px; }
    .row { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .col { display:flex; align-items:center; gap:8px; }
    button { padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:#f6f6f6; cursor:pointer; }
    button:hover { background:#eee; }
    textarea { width:100%; height:60vh; font-size:7pt; }
    input[type="text"] { width:6ch; text-align:center; }
    .small { font-size:12px; color:#666; }
  </style>
</head>
<body>
  <div id="page">
    <div class="row" style="margin-bottom:8px;">
      <div class="col" style="flex:1;">
        <button id="play" style="flex:1;">Play</button>
      </div>
      <div class="col" style="flex:1; justify-content:flex-end;">
        <button id="step" style="flex:1;">Step</button>
      </div>
    </div>

    <div class="row" style="margin-bottom:8px;">
      <div class="col">
        <button id="scorebtn">mistake</button>
        <input id="score" type="text" value="0" read-only>
      </div>
      <div class="col">
        <input type="checkbox" id="soundCheckbox" checked>
        <label for="soundCheckbox">sound</label>
        <span class="small" id="status"></span>
      </div>
    </div>
  </br>
    <div id="txtarea">
      <textarea id="textArea">
Priorities
   Address patient concern
   Assess for PPH (fundus, pad, wound)
Review Chart
   Time of birth
   Incisions
   epidural
   feeding
   Complications
   Notes on baby
Gather equipment
   gloves
   pad
Introduction
   enter room hand hygeine
   Introduce self (name and role)
   Ask Patient name, dob
   match bracelet to chart
   2 identifiers (name and number)
   inform client of intent
   obtain consent
Pain Assessment PQRSTU
   Provocative Palliative
   Qualities
   Region Radiation
   Severity 1 to 10
   Timing
   Understanding
   prepare for pain interventions (pharma or not)
      tylenol, advil, opioids
      padcicle, peri bottle
Breast assessment
   ask about skin integrity
   confrim latch both sides
   advise signs of good latch 
      should feel a firm tugging sensation but no pain
      baby sucks with cheeks rounded out not in
      swallowing is usually audible
   advise of feeding cues
      hand to mouth movements
      mouthing or sucking
      hunger posture, flexed arms and legs with fists
      crying is a late cue
   can expect to feed q2 to 3 or 8/24hr
Uterus Assessment
   LOWER BED FLAT
   place hand on pubic symph to brace
   palpate gently with other hand edge
   3 essential findings
      Position
      Tone 
      Height
Bladder Assessment
   ask about urination (frequency, discomfort, retention)
   recommend voiding q2h
      explain its important to void regularly for uterine involution
Bowel Assessment
   ask flatus or bowel movement
   encourage hydration
   if needed use softener (not laxative)
Lochia Assessment
   hand hygiene and put on clean gloves
   turn patient to side
   assess quantity scant light moderate heavy
   assess quality rubra serosa alba and clots
   check for pooling
   replace clean pad
   explain lochia progression
      rubra is red, 3 to 4 days
      serosa is pink brown, 2 to 4 weeks
      alba is yellow white, may last 4 to 6 weeks
      clots 1-2 cm are normal but we will asses them
      amount first two hours like a heavy period
        should steadily decrease over time
      soaking a pad in less than an hour is an emergency
      returning to regular discharge and cycle will vary
Wound Assessment
   patient still on side
   inspect laceration with reeda
      Redness
      Edema
      Ecchymosis
      Dishenence
      Approximation
   three interventions for pericare 
      padcicle
      peribottle with warm not hot water
      sitz bath
   inspect for hemorrhoids
   return patient to side and put on clean gloves    
Leg Assessment
   moving down to legs
   have you been able to ambulate
   assess for swelling both sides
   signs of dvt vte   
Psychosocial Assessment
   how else have you been feeling
   how is your support system
   approximately 50 to 80% experience postpartum blues, very normal
   usually a first day or two, peaks at 5 days and subsides by 10
   feelings of depression, anxiety, detachment
   some coping strategies are
      remembering that this is a very normal experience
      try to get plenty of rest and take care of yourself
      share your feelings with your partner and support and use them
   less common but still treatable we have mood disorders
      post partum anxiety which is pervasive apprehension or anxiety sometimes with intense attacks
      can also involve persistent intrusive thoughts
      post partum depression which is intense and pervasive sadness, not just the blues
      often with ruminations on guilt or doubt
   if you feel like you cant take care of yourself or baby then it is more than just baby blues, please seek help 
Closing
   ease in to closing 
   ask for any other concerns
   inform client of findings
   hand hygiene
   leave room
      </textarea>
    </div>
  </div>

  <audio id="ttsAudio" preload="auto"></audio>

  <script>
    // Replace with your Worker URL:
    const WORKER_URL = "https://postpartum-tts.chris8331.workers.dev/api/tts"; 
    const VOICE = "en-US-JennyNeural";
    const FORMAT = "audio-24khz-48kbitrate-mono-mp3";

    let lines = [];
    let index = 0;
    let playing = false;

    const playBtn = document.getElementById("play");
    const stepBtn = document.getElementById("step");
    const scoreBtn = document.getElementById("scorebtn");
    const scoreInput = document.getElementById("score");
    const textArea = document.getElementById("textArea");
    const soundCheckbox = document.getElementById("soundCheckbox");
    const audioEl = document.getElementById("ttsAudio");
    const statusEl = document.getElementById("status");

    function setStatus(msg) { statusEl.textContent = msg || ""; }

    async function speak(text) {
      if (!soundCheckbox.checked || !text.trim()) return;

      // Try Cloud TTS
      try {
        setStatus("cloud TTS…");
        const res = await fetch(WORKER_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text, voice: VOICE, format: FORMAT })
        });
        if (!res.ok) throw new Error(await res.text());
        const blob = await res.blob();
        if (blob.size < 2000) throw new Error("Empty audio");
        audioEl.src = URL.createObjectURL(blob);
        await audioEl.play();
        setStatus("");
        return; // success
      } catch (err) {
        console.warn("Cloud TTS failed, falling back:", err);
        setStatus("cloud TTS failed → local voice");
      }

      // Fallback: browser speechSynthesis
      try {
        const utter = new SpeechSynthesisUtterance(text);
        const voices = speechSynthesis.getVoices();
        utter.voice = voices.find(v => v.lang === "en-US") || voices.find(v => v.lang.startsWith("en")) || null;
        utter.rate = 1.0;
        utter.pitch = 1.0;
        speechSynthesis.speak(utter);
      } catch (err) {
        console.error("Local TTS also failed:", err);
        setStatus("all TTS failed");
      }
    }

    playBtn.addEventListener("click", function() {
      if (playing) return;
      playing = true;
      lines = textArea.value.split("\n");
      textArea.value = "";
      index = 0;
      playLines();
    });

    stepBtn.addEventListener("click", function() {
      if (index === 0) {
        lines = textArea.value.split("\n");
        textArea.value = "";
      }
      if (index <= lines.length && index !== 0) {
        const line = lines[index - 1];
        textArea.value += line + "\n";
        textArea.scrollTop = textArea.scrollHeight;
        speak(line);
      }
      index++;
    });

    scoreBtn.addEventListener("click", function() {
      scoreInput.value = parseInt(scoreInput.value, 10) + 1;
      textArea.value += "*** ^ ***\n";
    });

    function playLines() {
      if (index >= lines.length) {
        playing = false;
        return;
      }
      const line = lines[index];
      textArea.value += line + "\n";
      textArea.scrollTop = textArea.scrollHeight;
      speak(line);
      index++;
      setTimeout(playLines, 3000);
    }
  </script>
</body>
</html>
