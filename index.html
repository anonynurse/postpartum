<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Postpartum</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; padding:16px; }
    #page { margin:auto; width:100%; max-width:900px; }
    .row { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .col { display:flex; align-items:center; gap:8px; }
    button { padding:10px 14px; border:1px solid #ccc; border-radius:8px; background:#f6f6f6; cursor:pointer; }
    button:hover { background:#eee; }
    textarea { width:100%; height:60vh; font-size:8pt; }
    input[type="text"] { width:6ch; text-align:center; }
    .small { font-size:12px; color:#666; }
  </style>
</head>
<body>
  <div id="page">
    <div class="row" style="margin-bottom:8px;">
      <div class="col" style="flex:1;">
        <button id="play" style="flex:1;">Play</button>
      </div>
      <div class="col" style="flex:1; justify-content:flex-end;">
        <button id="step" style="flex:1;">Step</button>
      </div>
    </div>

    <div class="row" style="margin-bottom:8px;">
      <div class="col">
        <button id="scorebtn">mistake</button>
        <input id="score" type="text" value="0" read-only>
      </div>
      <div class="col">
        <input type="checkbox" id="soundCheckbox" checked>
        <label for="soundCheckbox">sound</label>
        <span class="small" id="status"></span>
      </div>
    </div>
  </br>
    <div id="txtarea">
      <textarea id="textArea">
Review Chart
   TOB
   Complications
   Notes on baby
Hand hygiene
Gather equipment
   gloves
   pad
Introduction
   Introduce self (name and role)
   Ask Patient name
   match bracelet to chart
   2 identifiers (name and number)
   inform client of intent
   obtain consent
Pain Assessment
   PQRSTU
   prepare for pain interventions (pharma or not)
Breast assessment
   confirm latch both sides
   advise signs of good latch (3)
      1
      2
      3
   advise of feeding cues (3)
      1
      2
      3
   can expect to feed q2-3 or 8/24hr
Uterus Assessment
   lower bed flat
   place hand on pubic symph to brace
   palpate gently with other hand edge
   ID 3 essential findings
      Position
      Tone 
      Height
Bladder Assessment
   ask about urine frequency discomfort retention
   recommend voiding q2h
   explain importance of frequency
Bowel Assessment
   ask flatus or bowel movement
   encourage hydration
   if needed use softener not laxative
Lochia Assessment
   hand hygiene 
   fresh gloves
   quantity scant light moderate heavy
   quality color and clots
   must turn patient to assess pooling
   inspect perineum
   3 pericare interventions
      1
      2
      3
   place fresh pad
   explain progression
      amount
      quality rubra serosa alba timeline
      seek medical if heavy, soak pad hour or less
      resuming regular menstruation and discharge will vary
Leg Assessment
   swelling edema pain in legs
   encourage activity for circulation and DVT   
Wound Assessment
   inspect lac and sutures
      REEDA
         redness
         edema 
         ecchymosis
         discharge
         approximation
   inspect for hemorrhoids
return patient to back and cover
Leg Assessment
   swelling edema pain in legs
   encourage activity for circulation and DVT
Psychosocial Assessment
   ask how they are feeling / mood
   ask about support systems
   explain 50 to 80% experience postpartum blues
      onset and duration 
      3 signs and symptoms
      3 coping strategies
   explain 15 to 85% experience mood disorders
   4 signs and symptoms
   where to seek help
Closing
   ease in to closing 
   ask for any other concerns
   inform client of findings
   hand hygiene
   leave room
      </textarea>
    </div>
  </div>

  <audio id="ttsAudio" preload="auto"></audio>

  <script>
    // Replace with your Worker URL:
    const WORKER_URL = "https://postpartum-tts.chris8331.workers.dev/api/tts"; 
    const VOICE = "en-US-JennyNeural";
    const FORMAT = "audio-24khz-48kbitrate-mono-mp3";

    let lines = [];
    let index = 0;
    let playing = false;

    const playBtn = document.getElementById("play");
    const stepBtn = document.getElementById("step");
    const scoreBtn = document.getElementById("scorebtn");
    const scoreInput = document.getElementById("score");
    const textArea = document.getElementById("textArea");
    const soundCheckbox = document.getElementById("soundCheckbox");
    const audioEl = document.getElementById("ttsAudio");
    const statusEl = document.getElementById("status");

    function setStatus(msg) { statusEl.textContent = msg || ""; }

    async function speak(text) {
      if (!soundCheckbox.checked || !text.trim()) return;

      // Try Cloud TTS
      try {
        setStatus("cloud TTS…");
        const res = await fetch(WORKER_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text, voice: VOICE, format: FORMAT })
        });
        if (!res.ok) throw new Error(await res.text());
        const blob = await res.blob();
        if (blob.size < 2000) throw new Error("Empty audio");
        audioEl.src = URL.createObjectURL(blob);
        await audioEl.play();
        setStatus("");
        return; // success
      } catch (err) {
        console.warn("Cloud TTS failed, falling back:", err);
        setStatus("cloud TTS failed → local voice");
      }

      // Fallback: browser speechSynthesis
      try {
        const utter = new SpeechSynthesisUtterance(text);
        const voices = speechSynthesis.getVoices();
        utter.voice = voices.find(v => v.lang === "en-US") || voices.find(v => v.lang.startsWith("en")) || null;
        utter.rate = 1.0;
        utter.pitch = 1.0;
        speechSynthesis.speak(utter);
      } catch (err) {
        console.error("Local TTS also failed:", err);
        setStatus("all TTS failed");
      }
    }

    playBtn.addEventListener("click", function() {
      if (playing) return;
      playing = true;
      lines = textArea.value.split("\n");
      textArea.value = "";
      index = 0;
      playLines();
    });

    stepBtn.addEventListener("click", function() {
      if (index === 0) {
        lines = textArea.value.split("\n");
        textArea.value = "";
      }
      if (index <= lines.length && index !== 0) {
        const line = lines[index - 1];
        textArea.value += line + "\n";
        textArea.scrollTop = textArea.scrollHeight;
        speak(line);
      }
      index++;
    });

    scoreBtn.addEventListener("click", function() {
      scoreInput.value = parseInt(scoreInput.value, 10) + 1;
      textArea.value += "*** ^ ***\n";
    });

    function playLines() {
      if (index >= lines.length) {
        playing = false;
        return;
      }
      const line = lines[index];
      textArea.value += line + "\n";
      textArea.scrollTop = textArea.scrollHeight;
      speak(line);
      index++;
      setTimeout(playLines, 3000);
    }
  </script>
</body>
</html>
